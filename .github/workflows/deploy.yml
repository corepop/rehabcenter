name: Trigger Cloudflare Pages Deployment

on:
  # Trigger on WordPress webhook
  repository_dispatch:
    types: [wordpress_webhook]
  # Allow manual trigger
  workflow_dispatch:

# Sets permissions for triggering deployments
permissions:
  contents: read
  deployments: write

# Allow only one concurrent deployment trigger
concurrency:
  group: "cloudflare-pages-trigger"
  cancel-in-progress: false

jobs:
  trigger:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Cloudflare Pages rebuild
        run: |
          echo "🔄 Triggering Cloudflare Pages deployment..."

          # Cloudflare Pages will handle the build process
          # This workflow just acknowledges the webhook and logs the event

          echo "✅ Deployment trigger received at: $(date)"
          echo "📝 Cloudflare Pages will automatically build from the repository"
          echo "🌐 Site will be available at: https://${{ secrets.CLOUDFLARE_PROJECT_NAME }}.pages.dev"

  notify:
    runs-on: ubuntu-latest
    needs: trigger
    if: always()
    steps:
      - name: Notify deployment status
        run: |
          if [ "${{ needs.trigger.result }}" = "success" ]; then
            echo "✅ Cloudflare Pages deployment triggered successfully!"
            echo "🔄 Build process will start automatically on Cloudflare Pages"
            echo "📊 Monitor deployment at: https://dash.cloudflare.com/pages"
          else
            echo "❌ Failed to process deployment trigger"
          fi
